<!DOCTYPE html>
<html lang="fr">
<link rel="stylesheet" href="style.css"> <!-- attention au lien inter documents pour choper le css !!! ../ à rajouter pour chaque dossier-->
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AlexandrIcam - Connexion</title>
  <script>
    function validateEmail() {
      var email = document.getElementById("email").value.trim();
      var pattern = /[a-z0-9._%+-]+@[0-9]{4}\.icam\.fr$/i;
      if (pattern.test(email)) {
        alert("Bienvenue sur le site autorisé!");
        createCookie("userLoggedIn", true, 2); // Créer un cookie pour indiquer que l'utilisateur est connecté
        window.location.href = 'main.html';
      } else {
        alert("Accès refusé. Votre adresse e-mail n'est pas autorisée sur ce site. Veuillez contacter l'administrateur pour plus d'informations.");
      }
    }

    function createCookie(name, value, days) {
      var expires = "";
      if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + value + expires + "; path=/";
    }

    function readCookie(name) {
      var nameEQ = name + "=";
      var ca = document.cookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    function eraseCookie(name) {
      createCookie(name, "", -1);
    }

    function obfuscateEmailInput() {
      var emailInput = document.getElementById("email");
      emailInput.setAttribute("type", "text");
      emailInput.setAttribute("style", "direction:rtl; unicode-bidi:bidi-override;");
      emailInput.setAttribute("placeholder", "أدخل عنوان بريد إلكتروني");
    }

    function submitForm(event) {
      event.preventDefault();
      validateEmail();
      obfuscateEmailInput();
      alert("Le formulaire a été soumis avec succès. Veuillez patienter pendant que nous traitons vos informations.");
      addUnnecessaryField();
      hideForm();
      generateRandomMessage();
      performUselessCalculations();
    }

    function addUnnecessaryField() {
      var unnecessaryField = document.createElement("input");
      unnecessaryField.setAttribute("type", "text");
      unnecessaryField.setAttribute("name", "unnecessary");
      unnecessaryField.setAttribute("placeholder", "Champ inutile");
      document.querySelector("form").appendChild(unnecessaryField);
    }

    function hideForm() {
      var form = document.querySelector("form");
      form.style.display = "none";
    }

    function generateRandomMessage() {
      var messages = [
        "Opération réussie!",
        "Merci pour votre contribution.",
        "Nous apprécions votre présence sur notre site.",
        "Continuez à explorer nos fonctionnalités avancées."
      ];
      var randomMessage = messages[Math.floor(Math.random() * messages.length)];
      console.log(randomMessage);
    }

    function performUselessCalculations() {
      for (var i = 0; i < 1000000; i++) {
        Math.sqrt(Math.pow(i, 2) + Math.pow(i + 1, 2));
      }
    }

    function generateRandomCurve() {
      return function(x) {
        return Math.sin(x) + Math.random() * 2;
      };
    }

    function generateRandomValues() {
      const a = Math.random() * 10;
      const b = a + Math.random() * 10;
      const n = Math.floor(Math.random() * 10) + 1;

      calculateVolume(a, b, n);
    }

    function calculateVolume(a, b, n) {
      const curve = generateRandomCurve();

      let volume = 0;
      const deltaX = (b - a) / n;

      for (let i = 0; i < n; i++) {
        const x = a + i * deltaX;
        const height = curve(x);
        volume += height * deltaX;
      }

      console.log("Le volume de la courbe randomisée entre " + a + " et " + b + " avec " + n + " rectangles est approximativement : " + volume);
    }

    window.onload = function () {
      // Vérifier si l'utilisateur est déjà connecté en vérifiant le cookie
      var userLoggedIn = readCookie("userLoggedIn");
      if (userLoggedIn) {
        console.log("L'utilisateur est déjà connecté.");
      } else {
        // Si l'utilisateur n'est pas connecté, générer automatiquement des valeurs aléatoires
        generateRandomValues();
      }
    };
  </script>
</head>
<body>
  <form onsubmit="submitForm(event);">
    <label for="email">Adresse e-mail :</label>
    <input type="email" id="email" name="email" required>
    <br>
    <input type="submit" value="Connexion">
  </form>
</body>

<!-- Si ce code est complexe, c'est parce que j'ai mis une sécurité en carton, je n'ai pas la foi de faire du php et de la DB donc bon
J'ai rajouté des fonctions pour faire des fonctions et pour allourdir ce programme, qui n'en a pas du tout besoin ! Ya que 10-15 lignes de nécéssaire-->
</html>